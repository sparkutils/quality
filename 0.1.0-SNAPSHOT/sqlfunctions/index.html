
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://sparkutils.github.io/quality/0.1.0-SNAPSHOT/sqlfunctions/" rel="canonical"/>
<link href="../site/scaladocs/com/sparkutils/quality/" rel="prev"/>
<link href="../img/quality.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.2" name="generator"/>
<title>SQL Functions Documentation - Quality</title>
<link href="../assets/stylesheets/main.7bf56d0a.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../stylesheets/site.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Quality" class="md-header__button md-logo" data-md-component="logo" href=".." title="Quality">
<img alt="logo" src="../img/quality.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Quality
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              SQL Functions Documentation
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/sparkutils/quality/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    Quality
  </div>
</a>
</div>
<a class="md-header__button md-header-nav__button md-icon" href="../pdf/document.pdf" title="PDF">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
<path d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z" fill="#E2E5E7"></path>
<path d="m384 128h96l-128-128v96c0 17.6 14.4 32 32 32z" fill="#B0B7BD"></path>
<polygon fill="#CAD1D8" points="480 224 384 128 480 128"></polygon>
<path d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16  V416z" fill="#F15642"></path>
<g fill="#fff">
<path d="m101.74 303.15c0-4.224 3.328-8.832 8.688-8.832h29.552c16.64 0 31.616 11.136 31.616 32.48 0 20.224-14.976 31.488-31.616 31.488h-21.36v16.896c0 5.632-3.584 8.816-8.192 8.816-4.224 0-8.688-3.184-8.688-8.816v-72.032zm16.88 7.28v31.872h21.36c8.576 0 15.36-7.568 15.36-15.504 0-8.944-6.784-16.368-15.36-16.368h-21.36z"></path>
<path d="m196.66 384c-4.224 0-8.832-2.304-8.832-7.92v-72.672c0-4.592 4.608-7.936 8.832-7.936h29.296c58.464 0 57.184 88.528 1.152 88.528h-30.448zm8.064-72.912v57.312h21.232c34.544 0 36.08-57.312 0-57.312h-21.232z"></path>
<path d="m303.87 312.11v20.336h32.624c4.608 0 9.216 4.608 9.216 9.072 0 4.224-4.608 7.68-9.216 7.68h-32.624v26.864c0 4.48-3.184 7.92-7.664 7.92-5.632 0-9.072-3.44-9.072-7.92v-72.672c0-4.592 3.456-7.936 9.072-7.936h44.912c5.632 0 8.96 3.344 8.96 7.936 0 4.096-3.328 8.704-8.96 8.704h-37.248v0.016z"></path>
</g>
<path d="m400 432h-304v16h304c8.8 0 16-7.2 16-16v-16c0 8.8-7.2 16-16 16z" fill="#CAD1D8"></path>
</svg>
</a></nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../getting_started/">
        Getting Started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../background/about/">
        About
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../model/">
        Model
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../advanced/blooms/">
        Advanced Usage
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../site/">
      Maven Site
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../site/scaladocs/com/sparkutils/quality/">
      Scala Docs
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="./">
      SQL Functions Documentation
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Quality" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Quality">
<img alt="logo" src="../img/quality.png"/>
</a>
    Quality
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/sparkutils/quality/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    Quality
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../getting_started/">
        Building and Setting Up
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../getting_started/a_first_rulesuite/">
        Defining &amp; Running your first RuleSuite
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../getting_started/flavours/">
        Those are some Quality flavours
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../getting_started/key_functions/">
        Key SQL Functions to use in your Rules
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../getting_started/serializing/">
        Reading &amp; Writing RuleSuites
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../getting_started/running_on_databricks/">
        Running Quality on Databricks
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          About
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          About
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../background/about/">
        History
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          Performance Choices
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
          Performance Choices
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../background/evaluation_method/">
        Evaluation Method
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../background/storage_method/">
        Storage Method
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../background/changelog/">
        Changelog
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Model
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Model
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../model/">
        Rule Model
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model/storage/">
        Storage Model
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model/meta/">
        Meta Rulesets?
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Advanced Usage
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Advanced Usage
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/blooms/">
        Bloom Filters
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/mapFunctions/">
        Map Functions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/aggregations/">
        Aggregation Functions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/userFunctions/">
        User Defined Functions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/prng/">
        PRNG Functions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/rowIdFunctions/">
        Row ID Functions
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
          QualityRules
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_7">
<span class="md-nav__icon md-icon"></span>
          QualityRules
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/ruleEngine/">
        Engine
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/ruleEngineWorkflow/">
        Workflow
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/ruleFolder/">
        QualityFolder
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/validation/">
        Validation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/expressionDocs/">
        Expression Documentation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../advanced/viewLoader/">
        View Loading
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../site/">
        Maven Site
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../site/scaladocs/com/sparkutils/quality/">
        Scala Docs
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          SQL Functions Documentation
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        SQL Functions Documentation
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_">
    _
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_lambda_">
    _lambda_
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#agg_expr">
    agg_Expr
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#as_uuid">
    as_uuid
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#big_bloom">
    big_Bloom
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#callfun">
    callFun
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coalesce_if_attributes_missing">
    coalesce_If_Attributes_Missing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coalesce_if_attributes_missing_disable">
    coalesce_If_Attributes_Missing_Disable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#comparable_maps">
    comparable_Maps
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#digest_to_longs">
    digest_To_Longs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#digest_to_longs_struct">
    digest_To_Longs_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#disabled_rule">
    disabled_Rule
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#failed">
    failed
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#field_based_id">
    field_Based_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#flatten_results">
    flatten_Results
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#flatten_rule_results">
    flatten_Rule_Results
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hash_field_based_id">
    hash_Field_Based_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hash_with">
    hash_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hash_with_struct">
    hash_With_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_base64">
    id_base64
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_equal">
    id_Equal
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_from_base64">
    id_from_base64
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_raw_type">
    id_raw_type
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_size">
    id_size
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inc">
    inc
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#long_pair">
    long_Pair
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#long_pair_equal">
    long_Pair_Equal
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#long_pair_from_uuid">
    long_Pair_From_UUID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#map_contains">
    map_Contains
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#map_lookup">
    map_Lookup
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#meanf">
    meanF
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#murmur3_id">
    murmur3_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pack_ints">
    pack_Ints
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#passed">
    passed
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prefixed_to_long_pair">
    prefixed_To_Long_Pair
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#print_code">
    print_Code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#print_expr">
    print_Expr
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#probability">
    probability
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#probability_in">
    probability_In
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#provided_id">
    provided_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#results_with">
    results_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#return_sum">
    return_Sum
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reverse_comparable_maps">
    reverse_Comparable_Maps
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng">
    rng
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng_bytes">
    rng_Bytes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng_id">
    rng_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng_uuid">
    rng_UUID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rule_suite_result_details">
    rule_Suite_Result_Details
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#small_bloom">
    small_Bloom
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#soft_fail">
    soft_Fail
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#soft_failed">
    soft_Failed
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sum_with">
    sum_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unique_id">
    unique_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unpack">
    unpack
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unpack_id_triple">
    unpack_Id_Triple
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update_field">
    update_Field
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_field_based_id">
    za_Field_Based_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_longs_with">
    za_Hash_Longs_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_longs_with_struct">
    za_Hash_Longs_With_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_with">
    za_Hash_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_with_struct">
    za_Hash_With_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_longs_field_based_id">
    za_Longs_Field_Based_ID
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_">
    _
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_lambda_">
    _lambda_
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#agg_expr">
    agg_Expr
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#as_uuid">
    as_uuid
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#big_bloom">
    big_Bloom
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#callfun">
    callFun
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coalesce_if_attributes_missing">
    coalesce_If_Attributes_Missing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coalesce_if_attributes_missing_disable">
    coalesce_If_Attributes_Missing_Disable
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#comparable_maps">
    comparable_Maps
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#digest_to_longs">
    digest_To_Longs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#digest_to_longs_struct">
    digest_To_Longs_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#disabled_rule">
    disabled_Rule
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#failed">
    failed
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#field_based_id">
    field_Based_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#flatten_results">
    flatten_Results
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#flatten_rule_results">
    flatten_Rule_Results
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hash_field_based_id">
    hash_Field_Based_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hash_with">
    hash_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hash_with_struct">
    hash_With_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_base64">
    id_base64
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_equal">
    id_Equal
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_from_base64">
    id_from_base64
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_raw_type">
    id_raw_type
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#id_size">
    id_size
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inc">
    inc
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#long_pair">
    long_Pair
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#long_pair_equal">
    long_Pair_Equal
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#long_pair_from_uuid">
    long_Pair_From_UUID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#map_contains">
    map_Contains
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#map_lookup">
    map_Lookup
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#meanf">
    meanF
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#murmur3_id">
    murmur3_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pack_ints">
    pack_Ints
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#passed">
    passed
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prefixed_to_long_pair">
    prefixed_To_Long_Pair
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#print_code">
    print_Code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#print_expr">
    print_Expr
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#probability">
    probability
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#probability_in">
    probability_In
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#provided_id">
    provided_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#results_with">
    results_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#return_sum">
    return_Sum
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reverse_comparable_maps">
    reverse_Comparable_Maps
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng">
    rng
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng_bytes">
    rng_Bytes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng_id">
    rng_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rng_uuid">
    rng_UUID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rule_suite_result_details">
    rule_Suite_Result_Details
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#small_bloom">
    small_Bloom
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#soft_fail">
    soft_Fail
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#soft_failed">
    soft_Failed
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sum_with">
    sum_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unique_id">
    unique_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unpack">
    unpack
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unpack_id_triple">
    unpack_Id_Triple
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update_field">
    update_Field
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_field_based_id">
    za_Field_Based_ID
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_longs_with">
    za_Hash_Longs_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_longs_with_struct">
    za_Hash_Longs_With_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_with">
    za_Hash_With
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_hash_with_struct">
    za_Hash_With_Struct
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#za_longs_field_based_id">
    za_Longs_Field_Based_ID
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>SQL Functions Documentation</h1>
<h2 id="_">_<a class="headerlink" href="#_" title="Permanent link">¶</a></h2>
<p>_( [ddl type], [nullable] ) provides PlaceHolders for lambda functions to allow partial application, use them in place of actual values or expressions to either change arity or allow use in _lambda_.</p>
<p>The default type is Long / Bigint, you will have to provide the types directly when using something else.  By default the placeholders are assumed to be nullable (i.e. true), you can use false to state the field should not be null.</p>
<h2 id="_lambda_">_lambda_<a class="headerlink" href="#_lambda_" title="Permanent link">¶</a></h2>
<p>_lambda_( user function ) extracts the Spark LambdaFunction from a resolved user function, this must have the correct types expected by the Spark HigherOrderFunction they are parameters for.</p>
<p>This allows using user defined functions and lambdas with in-built Spark HigherOrderFunctions</p>
<h2 id="agg_expr">agg_Expr<a class="headerlink" href="#agg_expr" title="Permanent link">¶</a></h2>
<p>agg_Expr( [ddl sum type], filter, sum, result) aggregates on rows which match the filter expression using the sum expression to aggregate then processes the results using the result expression.</p>
<p>You can run multiple agg_Expr's in a single pass select, use the first parameter to thread DDL type information through to the sum and result functions.</p>
<h2 id="as_uuid">as_uuid<a class="headerlink" href="#as_uuid" title="Permanent link">¶</a></h2>
<p>as_uuid(lower_long, higher_long) converts two longs into a uuid, equivalent to rngUUID(longPair(lower, higher))</p>
<h2 id="big_bloom">big_Bloom<a class="headerlink" href="#big_bloom" title="Permanent link">¶</a></h2>
<p>big_Bloom(buildFrom, expectedSize, expectedFPP) creates an aggregated bloom filter using the buildFrom expression.  </p>
<p>The blooms are stored on a shared filesystem using a generated uuid, they can scale to high numbers of items whilst keeping the FPP (e.g. millions at 0.01 would imply 99% probability, you may have to cast to double in Spark 3.2).</p>
<p>buildFrom can be driven by digestToLongs or hashWith functions when using multiple fields.</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
big_Bloom(buildFrom, expectedSize, expectedFPP, 'bloom_loc') - per above but uses a fixed string bloom_loc instead of a uuid
</div>
<h2 id="callfun">callFun<a class="headerlink" href="#callfun" title="Permanent link">¶</a></h2>
<p>callFun( user function lambda variable, param1, param2, … paramN ) used within a lambda function it allows calling a lambda variable that contains a user function.</p>
<p>Used from the top level sql it performs a similar function expecting either a full user function or a partially applied function, typically returned from another lambda user function.</p>
<h2 id="coalesce_if_attributes_missing">coalesce_If_Attributes_Missing<a class="headerlink" href="#coalesce_if_attributes_missing" title="Permanent link">¶</a></h2>
<p>coalesce_If_Attributes_Missing(expr, replaceWith) substitutes expr with the replaceWith expression when expr has missing attributes in the source dataframe.    Your code must call the scala processIfAttributeMissing function before using in validate or ruleEngineRunner/ruleRunner:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">missingAttributesAreReplacedRS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processIfAttributeMissing</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">struct</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validate</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="w"> </span><span class="n">missingAttributesAreReplacedRS</span><span class="p">)</span>

<span class="c1">// use it missingAttributesAreReplacedRS in your dataframe..</span>
</code></pre></div>
<h2 id="coalesce_if_attributes_missing_disable">coalesce_If_Attributes_Missing_Disable<a class="headerlink" href="#coalesce_if_attributes_missing_disable" title="Permanent link">¶</a></h2>
<p>coalesce_If_Attributes_Missing_Disable(expr) substitutes expr with the DisabledRule Integer result (-2) when expr has missing attributes in the source dataframe.  Your code must call the scala processIfAttributeMissing function before using in validate or ruleEngineRunner/ruleRunner:</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="n">missingAttributesAreReplacedRS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">processIfAttributeMissing</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">struct</span><span class="p">)</span>

<span class="kd">val</span><span class="w"> </span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validate</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="w"> </span><span class="n">missingAttributesAreReplacedRS</span><span class="p">)</span>

<span class="c1">// use it missingAttributesAreReplacedRS in your dataframe..</span>
</code></pre></div>
<h2 id="comparable_maps">comparable_Maps<a class="headerlink" href="#comparable_maps" title="Permanent link">¶</a></h2>
<p>comparable_Maps(struct | array | map) converts any maps in the input param into sorted arrays of a key, value struct.</p>
<p>This allows developers to perform sorts, distincts, group bys and union set operations with Maps, currently not supported by Spark sql as of 3.4.</p>
<p>The sorting behaviour uses Sparks existing odering logic but allows for extension during the calls to the registerQualityFunctions via the mapCompare parameter and the defaultMapCompare function.</p>
<h2 id="digest_to_longs">digest_To_Longs<a class="headerlink" href="#digest_to_longs" title="Permanent link">¶</a></h2>
<p>digest_To_Longs('digestImpl', fields*) creates an array of longs based on creating the given MessageDigest impl.  A 128-bit impl will generate two longs from it's digest</p>
<h2 id="digest_to_longs_struct">digest_To_Longs_Struct<a class="headerlink" href="#digest_to_longs_struct" title="Permanent link">¶</a></h2>
<p>digest_To_Longs_Struct('digestImpl', fields*) creates structure of longs with i0 to iN named fields based on creating the given MessageDigest impl.</p>
<h2 id="disabled_rule">disabled_Rule<a class="headerlink" href="#disabled_rule" title="Permanent link">¶</a></h2>
<p>disabledRule() returns the DisabledRule Integer result (-2) for use in filtering and to disable rules (which may not signify a version bump)</p>
<h2 id="failed">failed<a class="headerlink" href="#failed" title="Permanent link">¶</a></h2>
<p>failed() returns the Failed Integer result (0) for use in filtering</p>
<h2 id="field_based_id">field_Based_ID<a class="headerlink" href="#field_based_id" title="Permanent link">¶</a></h2>
<p>field_Based_ID('prefix', 'digestImpl', fields*) creates a variable bit length id by using a given MessageDigest impl over the fields, prefix is used with the _base, _i0 and _iN fields in the resulting structure</p>
<h2 id="flatten_results">flatten_Results<a class="headerlink" href="#flatten_results" title="Permanent link">¶</a></h2>
<p>flatten_Results(dataQualityExpr) expands data quality results into a flat array</p>
<h2 id="flatten_rule_results">flatten_Rule_Results<a class="headerlink" href="#flatten_rule_results" title="Permanent link">¶</a></h2>
<p>flatten_Rule_Results(dataQualityExpr) expands data quality results into a structure of flattenedResults, salientRule (the one used to create the output) and the rule result.</p>
<p>salientRule will be null if there was no matching rule</p>
<h2 id="hash_field_based_id">hash_Field_Based_ID<a class="headerlink" href="#hash_field_based_id" title="Permanent link">¶</a></h2>
<p>hash_Field_Based_ID('prefix', 'digestImpl', fields*) creates a variable bit length id by using a given Guava Hasher impl over the fields, prefix is used with the _base, _i0 and _iN fields in the resulting structure</p>
<h2 id="hash_with">hash_With<a class="headerlink" href="#hash_with" title="Permanent link">¶</a></h2>
<p>hash_With('HASH', fields*) Generates a hash value (array of longs) suitable for using in blooms based on the given Guava hash implementation.</p>
<p><em>Note</em> based on testing the digestToLongs function for SHA256 and MD5 are faster.  </p>
<p>Valid hashes: MURMUR3_32, MURMUR3_128, MD5, SHA-1, SHA-256, SHA-512, ADLER32, CRC32, SIPHASH24. When an invalid HASH name is provided MURMUR3_128 will be chosen.</p>
<details class="warning"><summary>Open source Spark 3.1.2/3 issues</summary><p>On Spark 3.1.2/3 open source this may get resolver errors due to a downgrade on guava version - 15.0 is used on Databricks, open source 3.0.3 uses 16.0.1, 3.1.2 drops this to 11 and misses crc32, sipHash24 and adler32.</p>
</details>
<h2 id="hash_with_struct">hash_With_Struct<a class="headerlink" href="#hash_with_struct" title="Permanent link">¶</a></h2>
<p>per hash_With('HASH', fields*) but generates a struct with i0 to ix named longs.  This structure is not suitable for blooms</p>
<h2 id="id_base64">id_base64<a class="headerlink" href="#id_base64" title="Permanent link">¶</a></h2>
<p>id_base64(base, i0, i1, ix) Generates a base64 encoded representation of the id, either the single struct field or the individual parts</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
id_base64(id_struct) Uses an id field to generate
</div>
<h2 id="id_equal">id_Equal<a class="headerlink" href="#id_equal" title="Permanent link">¶</a></h2>
<p>id_Equal(leftPrefix, rightPrefix) takes two prefixes which will be used to match leftPrefix_base = rightPrefix_base, i0 and i1 fields.  It does not currently support more than two i's </p>
<h2 id="id_from_base64">id_from_base64<a class="headerlink" href="#id_from_base64" title="Permanent link">¶</a></h2>
<p>id_from_base64(base64) Parses the base64 string with an expected default long size of two i.e. an 160bit ID, any string which is not of the correct size will return null</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
id_from_base64(base64f, size) Uses a size, which must be literal, to specify the type
</div>
<h2 id="id_raw_type">id_raw_type<a class="headerlink" href="#id_raw_type" title="Permanent link">¶</a></h2>
<p>id_raw_type(idstruct) Given a prefixed id returns the fields without their prefix</p>
<h2 id="id_size">id_size<a class="headerlink" href="#id_size" title="Permanent link">¶</a></h2>
<p>id_size(base64) Given a base64 from id_base64 returns the number of _i long fields</p>
<h2 id="inc">inc<a class="headerlink" href="#inc" title="Permanent link">¶</a></h2>
<p>inc() increments the current sum by 1</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
inc( x ) use an expression of type Long to increment
</div>
<h2 id="long_pair">long_Pair<a class="headerlink" href="#long_pair" title="Permanent link">¶</a></h2>
<p>long_Pair(lower, higher) creates a structure with these lower and higher longs</p>
<h2 id="long_pair_equal">long_Pair_Equal<a class="headerlink" href="#long_pair_equal" title="Permanent link">¶</a></h2>
<p>long_Pair_Equal(leftPrefix, rightPrefix) takes two prefixes which will be used to match leftPrefix_lower = rightPrefix_lower and leftPrefix_higher = rightPrefix_higher</p>
<h2 id="long_pair_from_uuid">long_Pair_From_UUID<a class="headerlink" href="#long_pair_from_uuid" title="Permanent link">¶</a></h2>
<p>long_Pair_From_UUID(expr) converts a UUID to a structure with lower and higher longs</p>
<h2 id="map_contains">map_Contains<a class="headerlink" href="#map_contains" title="Permanent link">¶</a></h2>
<p>map_Contains(expr, 'mapid') returns true if there is an item in the map</p>
<h2 id="map_lookup">map_Lookup<a class="headerlink" href="#map_lookup" title="Permanent link">¶</a></h2>
<p>map_Lookup(expr, 'mapid') returns either the lookup in map specified by mapid or null</p>
<h2 id="meanf">meanF<a class="headerlink" href="#meanf" title="Permanent link">¶</a></h2>
<p>meanF() simple mean on the results, expecting sum and count type Long</p>
<h2 id="murmur3_id">murmur3_ID<a class="headerlink" href="#murmur3_id" title="Permanent link">¶</a></h2>
<p>murmur3ID('prefix', fields*) Generates a 160bit id using murmer3 hashing over input fields, prefix is used with the _base, _i0 and _i1 fields in the resulting structure</p>
<h2 id="pack_ints">pack_Ints<a class="headerlink" href="#pack_ints" title="Permanent link">¶</a></h2>
<p>pack_Ints(lower, higher) a packaged long from two ints, used within result compression</p>
<h2 id="passed">passed<a class="headerlink" href="#passed" title="Permanent link">¶</a></h2>
<p>passed() returns the Passed Integer for use in filtering: 10000</p>
<h2 id="prefixed_to_long_pair">prefixed_To_Long_Pair<a class="headerlink" href="#prefixed_to_long_pair" title="Permanent link">¶</a></h2>
<p>prefixed_To_Long_Pair(field, 'prefix') converts a 128bit longpair field with the given prefix into a higher and lower long pair without prefix.</p>
<p>This is suitable for converting provided id's into uuids for example via a further call to rngUUID.   </p>
<h2 id="print_code">print_Code<a class="headerlink" href="#print_code" title="Permanent link">¶</a></h2>
<p>print_Code( [msg], expr ) prints the code generated by an expression, the value variable and the isNull variable and forwards eval calls / type etc. to the expression.</p>
<p>The code is printed once per partition on the <strong>executors</strong> std. output.  You will have to check each executor to find the used nodes output.  To use with unit testing on a single host you may overwrite the writer function in registerQualityFunctions, 
you should however use a top level object and var to write into (or stream), printCode will not be able to write to std out properly (spark redirects / captures stdout) or non top level objects (due to classloader / function instance issues).  Testing on other hosts
without using stdout should do so to a shared file location or similar.</p>
<p>!!! "information" It is not compatible with every expression
    Aggregate expressions like aggExpr or sum etc. won't generate code so they aren't compatible with printCode.</p>
<div class="highlight"><pre><span></span><code>\_lambda\_ is also incompatible with printCode both wrapping a user function and the \_lambda\_ function.  Similarly the \_() placeholder function cannot be wrapped.

Any function expecting a specific signature like aggExpr or other HigherOrderFunctions like aggregate or filter are unlikely to support wrapped arguements.
</code></pre></div>
<h2 id="print_expr">print_Expr<a class="headerlink" href="#print_expr" title="Permanent link">¶</a></h2>
<p>print_Expr( [msg], expr ) prints the expression tree via toString with an optional msg </p>
<p>The message is printed to the <strong>driver</strong> nodes std. output, often shown in notebooks as well.  To use with unit testing you may overwrite the writer function in registerQualityFunctions, 
you should however use a top level object and var to write into (or stream).</p>
<h2 id="probability">probability<a class="headerlink" href="#probability" title="Permanent link">¶</a></h2>
<p>probability(expr) will translate probability rule results into a double, e.g. 1000 returns 0.01. This is useful for interpreting and filtering on probability based results: 0 -&gt; 10000 non-inclusive</p>
<h2 id="probability_in">probability_In<a class="headerlink" href="#probability_in" title="Permanent link">¶</a></h2>
<p>probability_In(expr, 'bloomid') returns the probability of the expr being in the bloomfilter specified by bloomid.  </p>
<p>This function either returns 0.0, where it is definitely not present, or the original FPP where it <em>may</em> be present.</p>
<p>You may use digestToLongs or hashWith as appropriate to use multiple columns safely.</p>
<h2 id="provided_id">provided_ID<a class="headerlink" href="#provided_id" title="Permanent link">¶</a></h2>
<p>provided_ID('prefix', existingLongs) creates an id for an existing array of longs, prefix is used with the _base, _i0 and _iN fields in the resulting structure</p>
<h2 id="results_with">results_With<a class="headerlink" href="#results_with" title="Permanent link">¶</a></h2>
<p>results_With( x ) process results lambda x (e.g. (sum, count) -&gt; sum ) that takes sum from the aggregate, count from the number of rows counted.  Defaults both the sumtype and counttype as LongType</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
results_With( [sum ddl type], x) Use the given ddl type for the sum type e.g. 'MAP&lt;STRING, DOUBLE&gt;'
</div>
<div class="alternative">
results_With( [sum ddl type], [result ddl type], x) Use the given ddl type for the sum and result types
</div>
<h2 id="return_sum">return_Sum<a class="headerlink" href="#return_sum" title="Permanent link">¶</a></h2>
<p>return_Sum( sum type ddl ) just returns the sum and ignores the count param, expands to resultsWith( [sum ddl_type], (sum, count) -&gt; sum)</p>
<h2 id="reverse_comparable_maps">reverse_Comparable_Maps<a class="headerlink" href="#reverse_comparable_maps" title="Permanent link">¶</a></h2>
<p>reverses a call to comparableMaps</p>
<h2 id="rng">rng<a class="headerlink" href="#rng" title="Permanent link">¶</a></h2>
<p>rng() Generates a 128bit random id using XO_RO_SHI_RO_128_PP, encoded as a lower and higher long pair</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
rng('algorithm') Uses Commons RNG RandomSource to implement the RNG
</div>
<div class="alternative">
rng('algorithm', seedL) Uses Commons RNG RandomSource to implement the RNG with a long seed
</div>
<h2 id="rng_bytes">rng_Bytes<a class="headerlink" href="#rng_bytes" title="Permanent link">¶</a></h2>
<p>rng_Bytes() Generates a 128bit random id using XO_RO_SHI_RO_128_PP, encoded as a byte array</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
rng_Bytes('algorithm') Uses Commons RNG RandomSource to implement the RNG
</div>
<div class="alternative">
rng_Bytes('algorithm', seedL) Uses Commons RNG RandomSource to implement the RNG with a long seed
</div>
<div class="alternative">
rng_Bytes('algorithm', seedL, byteCount) Uses Commons RNG RandomSource to implement the RNG with a long seed, with a specific byte length integer (e.g. 16 is two longs, 8 is integer)
</div>
<h2 id="rng_id">rng_ID<a class="headerlink" href="#rng_id" title="Permanent link">¶</a></h2>
<p>rng_ID('prefix') Generates a 160bit random id using XO_RO_SHI_RO_128_PP, prefix is used with the _base, _i0 and _i1 fields in the resulting structure</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
rng_Id('prefix', 'algorithm') Uses Commons RNG RandomSource to implement the RNG, using other algorithm's may generate more long _iN fields
</div>
<div class="alternative">
rng_Id('prefix', 'algorithm', seedL) Uses Commons RNG RandomSource to implement the RNG with a long seed, using other algorithm's may generate more long _iN fields
</div>
<h2 id="rng_uuid">rng_UUID<a class="headerlink" href="#rng_uuid" title="Permanent link">¶</a></h2>
<p>rng_UUID(expr) takes either a structure with lower and higher longs or a 128bit binary type and converts to a string uuid</p>
<h2 id="rule_suite_result_details">rule_Suite_Result_Details<a class="headerlink" href="#rule_suite_result_details" title="Permanent link">¶</a></h2>
<p>rule_Suite_Result_Details(dq) strips the overallResult from the dataquality results, suitable for keeping overall result as a top-level field with associated performance improvements</p>
<h2 id="small_bloom">small_Bloom<a class="headerlink" href="#small_bloom" title="Permanent link">¶</a></h2>
<p>small_Bloom(buildFrom, expectedSize, expectedFPP) creates a simply bytearray bloom filter using the expected size and fpp - 0.01 is 99%, you may have to cast to double in Spark 3.2. buildFrom can be driven by digestToLongs or hashWith functions when using multiple fields.</p>
<h2 id="soft_fail">soft_Fail<a class="headerlink" href="#soft_fail" title="Permanent link">¶</a></h2>
<p>soft_Fail(ruleexpr) will treat any rule failure (e.g. failed() ) as returning softFailed()</p>
<h2 id="soft_failed">soft_Failed<a class="headerlink" href="#soft_failed" title="Permanent link">¶</a></h2>
<p>soft_Failed() returns the SoftFailed Integer result (-1) for use in filtering</p>
<h2 id="sum_with">sum_With<a class="headerlink" href="#sum_with" title="Permanent link">¶</a></h2>
<p>sum_With( x ) adds expression x for each row processed in an aggExpr with a default of LongType</p>
<p><strong>Alternatives:</strong></p>
<div class="alternative">
sum_With( [ddl type], x) Use the given ddl type e.g. 'MAP&lt;STRING, DOUBLE&gt;'
</div>
<h2 id="unique_id">unique_ID<a class="headerlink" href="#unique_id" title="Permanent link">¶</a></h2>
<p>uniqueID('prefix') Generates a 160bit guaranteed unique id (requires MAC address uniqueness) with contiguous higher values within a partition and overflow with timestamp ms., prefix is used with the _base, _i0 and _i1 fields in the resulting structure</p>
<h2 id="unpack">unpack<a class="headerlink" href="#unpack" title="Permanent link">¶</a></h2>
<p>unpack(expr) takes a packed rule long and unpacks it to a .id and .version structure</p>
<h2 id="unpack_id_triple">unpack_Id_Triple<a class="headerlink" href="#unpack_id_triple" title="Permanent link">¶</a></h2>
<p>unpack_Id_Triple(expr) takes a packed rule triple of longs (ruleSuiteId, ruleSetId and ruleId) and unpacks it to (ruleSuiteId, ruleSuiteVersion, ruleSetId, ruleSetVersion, ruleId, ruleVersion)</p>
<h2 id="update_field">update_Field<a class="headerlink" href="#update_field" title="Permanent link">¶</a></h2>
<p>update_Field(structure_expr, 'field.subfield', replaceWith, 'fieldN', replaceWithN) processes structures allowing you to replace sub items (think lens in functional programming) using the structure fields path name.</p>
<p>This is wrapped an almost verbatim version of <a href="https://raw.githubusercontent.com/fqaiser94/mse/master/src/main/scala/org/apache/spark/sql/catalyst/expressions/AddFields.scala">Make Structs Easier' AddFields</a></p>
<h2 id="za_field_based_id">za_Field_Based_ID<a class="headerlink" href="#za_field_based_id" title="Permanent link">¶</a></h2>
<p>za_Field_Based_ID('prefix', 'digestImpl', fields*) creates a 64bit id (96bit including header) by using a given Zero Allocation impl over the fields, prefix is used with the _base and _i0 fields in the resulting structure.</p>
<p>Prefer using the zaLongsFieldBasedID for less collisions</p>
<h2 id="za_hash_longs_with">za_Hash_Longs_With<a class="headerlink" href="#za_hash_longs_with" title="Permanent link">¶</a></h2>
<p>za_Hash_Longs_With('HASH', fields*) generates a multi length long array but with a <a href="https://github.com/OpenHFT/Zero-Allocation-Hashing">zero allocation implementation</a>.  This structure is suitable for blooms, the default XXH3 algorithm is the 128bit version of that used by the internal bigBloom implementation.</p>
<p>Available HASH functions are MURMUR3_128, XXH3</p>
<h2 id="za_hash_longs_with_struct">za_Hash_Longs_With_Struct<a class="headerlink" href="#za_hash_longs_with_struct" title="Permanent link">¶</a></h2>
<p>similar to za_Hash_Longs_With('HASH', fields*) but generates an ID relevant multi length long struct, which is not suitable for blooms</p>
<h2 id="za_hash_with">za_Hash_With<a class="headerlink" href="#za_hash_with" title="Permanent link">¶</a></h2>
<p>za_Hash_With('HASH', fields*) generates a single length long array always with 64 bits but with a <a href="https://github.com/OpenHFT/Zero-Allocation-Hashing">zero allocation implementation</a>.  This structure is suitable for blooms, the default XX algorithm is used by the internal bigBloom implementation.</p>
<p>Available HASH functions are MURMUR3_64, CITY_1_1, FARMNA, FARMOU, METRO, WY_V3, XX</p>
<h2 id="za_hash_with_struct">za_Hash_With_Struct<a class="headerlink" href="#za_hash_with_struct" title="Permanent link">¶</a></h2>
<p>similar to za_Hash_With('HASH', fields*) but generates an ID relevant multi length long struct (of one long), which is not suitable for blooms.</p>
<p>Prefer zaHashLongsWithStruct for reduced collisions with either the MURMUR3_128 or XXH3 versions of hashes</p>
<h2 id="za_longs_field_based_id">za_Longs_Field_Based_ID<a class="headerlink" href="#za_longs_field_based_id" title="Permanent link">¶</a></h2>
<p>za_Longs_Field_Based_ID('prefix', 'digestImpl', fields*) creates a variable length id by using a given Zero Allocation impl over the fields, prefix is used with the _base, _i0 and _iN fields in the resulting structure. Murmur3_128 is faster than on the Guava implementation.</p>
<hr/>
<div class="md-source-file">
<small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">June 14, 2023 14:56:34</span>
<br/>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">June 14, 2023 14:56:34</span>
</small>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "navigation.expand", "content.code.copy"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
<script src="../assets/javascripts/bundle.fc8c2696.min.js"></script>
<script src="../js/jquery-3.6.3.min.js"></script>
<script src="../js/tagflipper.js"></script>
</body>
</html>